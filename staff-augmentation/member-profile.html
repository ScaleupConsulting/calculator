<style>
	@import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap');
</style>

<head>
	<link rel="stylesheet" href="style.css">
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<div style="width: 1512px; position: relative; margin: auto;">
	<!--copy below this to wordpress-->
	<script>
		(async () => {
			const response = await fetch('https://sheets.googleapis.com/v4/spreadsheets/1EeU849RAahYBTPXC85WFuHkJLa0JhwwgTBrJbS3c7kw/values/profiles?alt=json&key=AIzaSyAssRDe2nf-mYoaHRQb88Rk-Hmgtn_GrnE');
			const json = await response.json();
			const [header, ...data] = json.values;

			const projectSheet = await fetch('https://sheets.googleapis.com/v4/spreadsheets/1EeU849RAahYBTPXC85WFuHkJLa0JhwwgTBrJbS3c7kw/values/projects?alt=json&key=AIzaSyAssRDe2nf-mYoaHRQb88Rk-Hmgtn_GrnE');
			const projectJson = await projectSheet.json();
			const [projectHeader, ...projectRawData] = projectJson.values;

			/* Project columns name*/
			const Member = "Member Name";
			const ProjectName = "Project Name";
			const Logo = "Upload your project logo";
			const Link = "Project URL"
			/* Project columns name*/

			/* Profile columns name*/
			const Name = "Name:";
			const Avatar = "Upload Your Image:";
			const Country = "Country:";
			const Title = "Headline (Profile Title):";
			const Review = "Review (max length 320 characters):";
			const Skills = "Preferred Technology:";
			const Rate = "Rate/Hour (AUD):";
			const Availability = "Availability ( per week):";
			const Experience = "Experience (only in number of years):";
			const JobSuccess = "JobSuccess";
			const Linkedin = "LinkedIn Profile:";
			const Codementor = "Codementor Profile:";
			const Upwork = "Upwork Profile:";
			const Toptal = "Toptal Profile:";
			const RisingTalent = "RisingTalent";
			const TopRated = "TopRated";
			const TopRatedPlus = "TopRatedPlus";
			const ExpertVetted = "ExpertVetted";
			/* Profile columns name*/

			const projectData = projectRawData.map(data => (
				data.reduce((acc, curr, index) => {
					acc[projectHeader[index]] = curr;
					return acc;
				}, {})
			));

			const contries = await fetch('https://flagicons.lipis.dev/country.json').then(res => res.json());

			const container = document.querySelector('.staff-profiles');

			window.onSubmitForm = function (e) {
				e.preventDefault();
				console.log(e);
				const service_id = 'service_me3fj46';
				const template_id = 'template_gehkc1j';
				const user_id = 'AxzgF3774nXj7bELh';
				emailjs.sendForm(service_id, template_id, '#contact-form', user_id);
			}

			data.forEach(x => {
				const profile = header.reduce((acc, curr, index) => {
					acc[curr] = x[index];
					return acc;
				}, {});

				const projectList = projectData.filter(data => data[Member] === profile[Name]);
				const listProject = projectList.map(project => (`
					<div class="project-box">
						<a id="anchor${project[ProjectName]}" ${project[Link] ? `href=${project[Link]}` : ''} target="_blank">
							<img class="project-logo" src=${project[Logo].replace('open', 'uc') + "&export=view"} alt="${project[ProjectName]}">
						</a>
					</div>
				`)).join('');
				//https://flagicons.lipis.dev/
				const country = contries.find(country => country.name.toLowerCase() === profile[Country].toLowerCase());
				const countryFlag = country ? `https://flagicons.lipis.dev/${country.flag_4x3}` : '';
				container.insertAdjacentHTML('afterbegin',
					`<div class="main-box">
						<div style="display: flex; flex-direction: row">
							<div class="box1">
								
								<div class="innerbox1"> ${profile[Name]} <img class="flag" src=${countryFlag} alt="${profile[Country]}" > </div>
								<img class="staff-images" src=${profile[Avatar] && profile[Avatar].replace('open', 'uc') + "&export=view"} alt="${profile[Name]}">
								<br>
								<div class="availability"> Availability: ${profile[Availability]} </div>
								<button class="contact-btn"> Contact ${profile[Name]} </button>
							</div> 

							<div class="box2">
								<div class="job-profile">
									<div class="job-title"> ${profile[Title]} </div>
									<p class="job-details"> ${profile[Review]}  </p>
								</div>
								<div class="past-project"> Past Projects </div>

								<div class="project-boxes">
									${listProject}
								</div>
								<div class="past-project"> Preferred Technology </div>

								<div class="qualification-boxes">
									${profile[Skills].split(',').map(skill => (
						`<div class="qualification-box">
											<p>${skill}</p>
										</div>`
					)).join('')}
								</div>
							</div>

							<div class="box3">
								${profile[JobSuccess] ? `<div class="job-success"> ${profile[JobSuccess]} job success </div>` : ""}
								<div class="rate"> Rate: $${profile[Rate]}/hr </div>
								${profile[RisingTalent] ? `<div class="rated"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-name="Layer 1" viewBox="0 0 14 14" role="img"><polygon fill="#1caf9d" points="7 0 0 0 0 9.21 7 14 14 9.21 14 0 7 0"></polygon></svg>   Rising Talent </div>` : ''}	
								${profile[TopRated] ? `<div class="rated"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-name="Layer 1" viewBox="0 0 14 14" role="img"><polygon fill="#5aa2c6" points="6.98 0 0 0 0 9.21 6.98 14 13.95 9.21 13.95 0 6.98 0"></polygon><polygon fill="#0b83b2" points="0.05 9.21 7.02 14 14 9.21 14 0 0.05 9.21"></polygon></svg>   Top rated </div>` : ''}
								${profile[TopRatedPlus] ? `<div class="rated"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-name="Layer 1" viewBox="0 0 14 14" role="img"><polygon fill="#f86d9c" points="6.98 0 0 0 0 9.21 6.98 14 13.95 9.21 13.95 0 6.98 0"></polygon><polygon fill="#fba0bd" points="0 0 14 9.21 14 0 0 0"></polygon><polygon fill="#f1367a" points="0.05 9.21 7.02 14 14 9.21 14 0 0.05 9.21"></polygon></svg>   Top rated plus </div>` : ''}
								${profile[ExpertVetted] ? `<div class="rated"><img src="https://assets-global.website-files.com/603fea6471d9d8559d077603/6253fdd311f245fe594c9788_badge-vetted-talent.png"/>   Expert vetted </div>` : ''}
								<div class="experience"> <span class="years" data-years="${profile[Experience]}+"> ${profile[Experience]}</span> years experience </div>
								<div class="professional-links">
								${profile[Linkedin] ? `<a href="${profile[Linkedin]}" target="_blank"> <img class="profile-icon" src="images/profile/linkedin.png" alt="linkedin"> </a>` : ""}
									${profile[Codementor] ? `<a href="${profile[Codementor]}" target="_blank"> <img class="profile-icon" src="images/profile/codementor.png" alt="codementor"> </a>` : ""}
									${profile[Upwork] ? `<a href="${profile[Upwork]}" target="_blank"> <img class="profile-icon" src="images/profile/upwork.webp" alt="upwork"> </a>` : ""}
									${profile[Toptal] ? `<a href="${profile[Toptal]}" target="_blank"> <img class="profile-icon" src="images/profile/toptal.png" alt="toptal"> </a>` : ""}
								</div>
							</div>
						</div>
						<div class="contact-modal">
							<div class="modal-content" style="padding: 0 2.5rem">
								<form method="POST" id="contact-form" onsubmit="onSubmitForm.apply(this, arguments)">
									<div style="display: flex">
										<input type="text" placeholder="Name" name="name" required>
										<input type="email" placeholder="Email" name="email" required>
										<input type="text" placeholder="Subject" name="subject" required>
									</div>
									<textarea placeholder="Message" name="message" required></textarea>
									<input type="hidden" name="recipient" value="${profile[Name]}">
									<input type="submit" value="Send" id="contact-${profile[Name]}-submit">
								</form>
							</div>
						</div>
					</div>`
				);

				var contactButton = document.querySelector(`.contact-btn`);
				const onClickContactButton = function () {
					const contactModal = document.querySelector('.contact-modal');
					contactModal.style.display = contactModal.style.display == 'block' ? 'none' : 'block';
				}
				contactButton.addEventListener('click', onClickContactButton);

			});
		})();
	</script>

	<div class="staff-profiles"></div>
	<!-- copy above this to wordpress -->
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			var forms = document.querySelector('#contact-form');
			console.log(forms);
		});
		var forms = document.querySelector('#contact-form');
		console.log(forms);
		forms.forEach(form => {
			form.addEventListener('submit', function (e) {
				e.preventDefault();
				console.log('submitting form')
				// var formData = new FormData(form);
				// var xhr = new XMLHttpRequest();
				// xhr.open('POST', form.action, true);
				// xhr.onload = function () {
				// 	if (this.status == 200) {
				// 		alert('Email sent successfully');
				// 	} else {
				// 		alert('Email failed to send');
				// 	}
				// }
				// xhr.send(formData);
			});
		});
	</script>

</div>